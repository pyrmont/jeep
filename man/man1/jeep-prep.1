.\"
.\" Generated by predoc at 2025-11-19T01:31:06Z
.\"
.Dd November 6, 2025
.Dt JEEP-PREP 1
.Os Jeep DEVEL
.
.Sh NAME
.Nm jeep-prep
.Nd prepare a Janet bundle
.
.Sh SYNOPSIS
.Nm
.Oo
.Fl f No \&|
.Fl "-force-deps"
.Oc
.Oo
.Fl D No \&|
.Fl "-no-deps"
.Oc
.Oo
.Ar profile
.Oc
.
.Sh DESCRIPTION
.Nm
prepares a Janet bundle.
A bundle is prepared for a given profile by installing dependencies
and running the prep
.Sy bundle hook .
.
.Ss Options
.Bl -tag -width Ds
.It Xo
.Fl f ,
.Fl "-force-deps"
.Xc
This forces the installation of dependencies.
By default,
Janet will not install a dependency if it is already installed.
.It Xo
.Fl D ,
.Fl "-no-deps"
.Xc
This skips the installation of dependencies.
In other words,
it only runs the prep
.Sy bundle hook .
.It Xo
.Ar profile
.Xc
Specifies one of the following profiles to use:
.Bl -tag -width Ds
.It Xo
.Cm system
.Xc
By default,
.Nm
will use the
.Cm system
profile.
This installs the dependencies listed under
.Ql ":dependencies"
key in the
.Sy info file .
The dependencies are installed to the
.Sy syspath .
.It Xo
.Cm build
.Xc
If the user specifies the
.Cm build
profile,
this copies into the
.Eo
.Pa ./bundle
.Ec
directory several files from the Spork library that are commonly
used at build-time:
.Pp
.Bl -bullet -offset 3n -compact
.It
build-rules.janet
.It
cc.janet
.It
cjanet.janet
.It
declare-cc.janet
.It
path.janet
.It
pm-config.janet
.It
sh.janet
.It
stream.janet
.El
.It Xo
.Cm vendor
.Xc
If the user specifies the
.Cm vendor
profile,
this vendors the dependencies listed under the
.Ql ":vendored"
key in the
.Sy info file .
.El
.El
.Pp
For more information about the
.Sy info file ,
the
.Sy bundle script ,
.Sy bundle hooks
and the
.Sy syspath ,
see CONCEPTS in
.Xr jeep 1 .
For more information about vendoring,
see Vendoring in
.Xr jeep-dep 1 .
.
.Sh OPERATION
.Nm
consists of a two-step workflow.
First,
dependencies are installed.
Second,
the prep
.Sy bundle hook
is run.
.Pp
The bundle author specifies each dependency using a struct.
The struct should,
at a minimum,
include the
.Ql ":name"
and
.Ql ":url"
keys.
If the struct includes a
.Ql ":paths"
key,
the dependency is not installed using the Janet’s
.Ql "bundle/install"
function.
Instead
.Nm
downloads the dependency and then copies the paths listed.
Paths can be specified as strings or as two- element array/tuples
containing a source and destination path.
The source path is relative to the root of the dependency.
The destination path is relative to the directory specified
in the
.Ql ":prefix"
(if no directory is specified,
the bundle root).
Dependencies can be added to the
.Sy info file
using
.Xr jeep-dep 1 .
.Pp
The bundle author optionally binds a function to the prep
.Sy bundle hook
by defining a function called
.Ql "prep"
in the
.Sy bundle script .
When invoked,
the function will receive two arguments:
(1)
a table representing the bundle manifest and (2)
a string matching the name of the profile specified by the user.
.
.Sh EXAMPLES
The following examples assume an
.Sy info file
as follows:
.Bd -literal -offset indent
{:name \(dqexample\(dq
 :url \(dqhttps://example\&.org/example\(dq
 :repo \(dqgit+https://example\&.org/example\(dq

 :dependencies \(lB
   {:name \(dqdep1\(dq
    :url \(dqhttps://example\&.org/dep1\(dq}
   {:name \(dqdep2\(dq
    :url \(dqhttps://example\&.org/dep2\(dq}\(rB

 :vendored \(lB
   {:name \(dqdep3\(dq
    :url \(dqhttps://example\&.org/dep3\(dq
    :prefix \(dqbundle\(dq}
   {:name \(dqdep4\(dq
    :url \(dqhttps://example\&.org/dep4\(dq
    :prefix \(dqdeps\(dq}
   {:name \(dqdep5\(dq
    :url \(dqhttps://example\&.org/dep5\(dq
    :prefix \(dqdeps/dep5\(dq
    :paths \(lB\(dqfoo\&.janet\(dq
            \(dqLICENSE\(dq\(rB}\(rB}
.Ed
.Pp
The following command prepares the bundle using the default
.Cm system
profile.
This installs ‘dep1’ and ‘dep2’ to the global syspath.
.Bd -literal -offset indent
$ jeep prep
.Ed
.Pp
The following command prepares the bundle using the
.Cm system
profile.
This installs ‘dep1’ and ‘dep2’ to
.Eo
.Pa ./_system
.Ec ,
the local syspath.
.Bd -literal -offset indent
$ jeep -l prep system
.Ed
.Pp
The following command prepares the bundle using the
.Cm vendor
profile.
This installs ‘dep3’ to the
.Eo
.Pa ./bundle
.Ec
directory,
installs ‘dep4’ to the
.Eo
.Pa ./deps
.Ec
directory and copies ‘foo.janet’ and ‘LICENSE’ to the
.Eo
.Pa ./deps/dep5
.Ec
directory.
.Bd -literal -offset indent
$ jeep prep vendor
.Ed
.Pp
The following command prepares the bundle using the
.Cm build
profile.
This copies the default build-time files to
.Eo
.Pa ./bundle
.Ec .
.Bd -literal -offset indent
$ jeep prep build
.Ed
.
.Sh AUTHORS
.An Michael Camilleri Aq Mt mike@inqk.net
.
.Sh BUGS
Report issues at
.Lk https://github.com/pyrmont/jeep
